---
title: "PFAS_analysis_KN"
author: "Karly Nocera and Tay Holiday"
date: "4/16/2021"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup, include=FALSE}
# Set your working directory

getwd()

# Load your packages

library(tidyverse)
library(lubridate)

# Set your ggplot theme

mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")

theme_set(mytheme)

# Load your datasets
PFAS_long_clean <- read.csv("./Data/Processed/PFAS_long_clean.csv", stringsAsFactors = TRUE)

PFAS_wide_clean <- read.csv("./Data/Processed/PFAS_wide_clean.csv", stringsAsFactors = TRUE)

```


# Analysis

Insert visualizations and text describing your main analyses. Format your R chunks so that graphs are displayed but code and other output is not displayed. Instead, describe the results of any statistical tests in the main text (e.g., "Variable x was significantly different among y groups (ANOVA; df = 300, F = 5.55, p < 0.0001)"). Each paragraph, accompanied by one or more visualizations, should describe the major findings and how they relate to the question and hypotheses. Divide this section into subsections, one for each research question.

Each figure should be accompanied by a caption, and each figure should be referenced within the text




## Question 1: Source Data Analytes

### Question 1a: Long v Short

```{r}

# want to know what type of remediation is needed to deal with their contamination (GAC short chain; RO both)

# add up all the ppt for long at the site; add up ppt for short

#I'm sure there's a way to do it this way, but not working
#chain_long <- c('PFDS','PFDA','PFDoA','PFHpS','PFHxS','PFNS','PFNA','PFOSA','N.EtFOSAA','N.MeFOSAA','PFTeA','PFTriA','PFUnA','HFPO.DA','PFOA','PFOS')

#chain_short <- c(PFBA, PFBS,PFHpA,PFHxA,PFPeS,PFPeA)

PFAS_wide_clean <- 
    PFAS_wide_clean %>% 
    rowwise() %>% 
    mutate(short.ppt = sum(PFBA, PFBS, PFHpA, PFHxA, PFPeS, PFPeA, na.rm = TRUE)) %>%
    mutate(long.ppt = sum(PFDS, PFDA, PFDoA, PFHpS, PFHxS, PFNS, PFNA, PFOSA, N.EtFOSAA, N.MeFOSAA, PFTeA, PFTriA, PFUnA, HFPO.DA, PFOA, PFOS, na.rm = TRUE))
  
# stacked histogram ppt vs site

Site <- PFAS_wide_clean$Site
short.ppt <- PFAS_wide_clean$short.ppt
long.ppt <- PFAS_wide_clean$long.ppt

df2 <- rbind(data.frame(Site, "ppt" = short.ppt, "Chain"="Short"), data.frame(Site, "ppt" = long.ppt, "Chain"="Long"))

ggplot(df2, aes(x = Site, y = ppt))+
  geom_col(aes(fill = Chain))


# histogram by long chain, maybe color it later

ggplot(PFAS_long_clean, aes(fill=Analyte, y=ppt, x=Site)) + 
    geom_bar(position="stack", stat="identity")

```

### Question 1b: Top 5 Analytes

```{r}

# facet wrap each site by x = analyte y = ppt

# looks terrible.

ggplot(subset(PFAS_long_clean, Type == "Source"), aes(x = Analyte, y = ppt)) + 
  geom_bar(stat="identity") +
  facet_wrap(vars(Site), nrow = 11)

# !is.na does nothing
#ggplot(subset(PFAS_long_clean, Type == "Source", !is.na(ppt)), aes(x = Analyte, y = ppt)) + 
 # geom_bar(stat="identity") +
#  facet_wrap(vars(Site), nrow = 11)

```


### Question 1c: Are there rivers that are scary we aren't talking about? (high and type of analyte)

```{r}

# starting to look the same as 1b -- which sites had the higher analytes

```

### Question 1d: [Tay] Are any spots with one analyte over 70? over 30?

```{r}
#Any locations with Analyte above 30? 70?
#To do this, a simple pipe should do to filter out which analytes/site are above the given value.
#EPA_Processed_2018$Result <- subset(EPA_Processed_2018$Result, !is.na()) #converts the result into a numeric value instead of a factor

source_analyte_above_30 <- 
  PFAS_long_clean %>%
  filter(Type == "Source") %>%
  filter(ppt > 30)

source_analyte_above_70 <- 
  PFAS_long_clean %>%
  filter(Type == "Source") %>%
  filter(ppt > 70)

unique(source_analyte_above_30$Site) #11 Sites above 30 
unique(source_analyte_above_70$Site) #5 sites above 70



pfoapfos.source <- 
  ggplot(PFAS_wide_clean, aes(x = Site, y = sum_pfoa.pfos)) +
  geom_hline(yintercept = 70, lty = 2) +
  geom_point(alpha = 0.5, size = 1.5) +
  ylim(0,150) +
  ylab(expression("PPT")) +
  theme(axis.text.x = element_blank())

total.source <- 
  ggplot(PFAS_wide_clean, aes(x = Site, y = sum_pfas)) +
  geom_hline(yintercept = 20, lty = 2) +
  geom_hline(yintercept = 70, lty = 2) +
  geom_point(alpha = 0.5, size = 1.5) +
  ylim(0,150) +
  ylab(expression("PPT")) +
  theme(axis.text.x = element_blank())

print(pfoapfos.source)

print(total.source)


â˜»```


### Question 1e: [Tay] Total PFAS over 130

```{r}

#Total PFAS over 130

# sum of pfas for every source site at that date
# filter for those over 130
# unique for how many sites had total pfas over 130

Total_PFAS_Source_Over130 <- 
  PFAS_wide_clean %>%
  filter (Type == "Source") %>%
  filter (sum_pfas > 130)

## hey, Tay. Do this. Please :) 

# rename without dashes

rename(PFAS_wide_clean, petal_length = Petal.Length)

PFAS_wide_clean <-
  PFAS_wide_clean %>%
  mutate(TotalPFAS = (PFBA + PFBS + PFDS + PFDA + PFDoA + PFHpS + PFHpA + PFHxS + PFHxA + PFNS + PFNA + PFOSA + N.EtFOSAA + N.MeFOSAA + PFPeS + PFPeA + PFTeA + PFTriA + PFUnA + HFPO.DA + PFOA + PFOS), na.rm=TRUE)

PFAS_wide_sum <-
  PFAS_wide_clean %>%
  mutate(TotalPFAS = (PFBA + PFBS + PFDS + PFDA + PFDoA + PFHpS + PFHpA + PFHxS + PFHxA + PFNS + PFNA + PFOSA + N.EtFOSAA + N.MeFOSAA + PFPeS + PFPeA + PFTeA + PFTriA + PFUnA + HFPO.DA + PFOA + PFOS, na.rm=TRUE))

PFAS_wide_sum <-
  PFAS_wide_clean %>%
  mutate(TotalPFAS = sum(PFBA:PFOS, na.rm=TRUE))

PFAS_wide_sum

#YAY! Got it!

```

### Question 1f: Temporal relationships?

```{r}

# no, because only sampled on one day

```


## Question 2: Source Data ND/Qualifiers

### Question 2a: [Tay] Summary Stats: ND below 5; ND below 10; ND below 20 (distrubtion bell curve)

```{r}



```



### Question 2b: [Tay] Percentages (how many ND / total detections under 30) within any. Within GenX. See how many of which analytes have the worst percentage rations --> play with those trends

```{r}

```


### Question 2c: [Tay] ND: Variability of lab qualifiers (know the level is above/below U) - by analyte per Source

```{r}

```



## Question 3: WWTP Analytes

### Question 3a: PFOA, PFOS, GenX, sum PFAS accross sites (by month, facet wrap)

```{r}



```


### Question 3b: Top 3? 5? analytes (aka are there analytes we aren't looking at) -- by chain length
```{r}


```


### Question 3c: Within a plant, is there a temporal trend (facet_wrap; 25 rows)
```{r}

```


### Question 3d: Long vs Short

```{r}



```

### Question 3e: [Tay] Are any spots with one analyte over 70? over 30?

```{r}

wwtp_analyte_above_30 <- 
  PFAS_long_clean %>%
  filter(Type == "WWTP") %>%
  filter(ppt > 30)

wwtp_analyte_above_70 <- 
  PFAS_long_clean %>%
  filter(Type == "WWTP") %>%
  filter(ppt > 70)

unique(wwtp_analyte_above_30$Site) #21 Sites above 30 
unique(wwtp_analyte_above_70$Site) #13 sites above 70

```

### Question 1e: [Tay] Total PFAS over 130

```{r}

```





## Question 4: WWTP ND/Qualifiers

### Question 4a: [Tay] Summary Stats: ND below 5; ND below 10; ND below 20 (distrubtion bell curve)

```{r}

```

### Question 4b: [Tay] Percentages (how many ND / total detections under 30) within any. Within GenX. See how many of which analytes have the worst percentage rations --> play with those trends

```{r}

```

### Question 4c: [Tay] ND: Variability of lab qualifiers (know the level is above/below U) - by analyte per WWTP

```{r}

```


